<?xml version="1.0"?>
  <database name="TRIGGER SHPPWS_CHECK_DEFAULT_RSK_TRG">
    <trigger name="SHPPWS_CHECK_DEFAULT_RSK_TRG" table="SHPPEE_RISK_INDEX" fires="before" insert="true" update="true" delete="false" foreach="row">
      <body><![CDATA[BEGIN
  IF AD_isTriggerEnabled()='N' THEN
    IF DELETING THEN
      RETURN OLD;
    ELSE
      RETURN NEW;
    END IF;
  END IF;

  -- Solo validar si el nuevo registro tiene 'Y'
  IF :NEW.EM_Shppws_Default_Rsk_Seg = 'Y' THEN
    -- Buscar si ya existe otro registro con 'Y'
    IF EXISTS (
      SELECT 1
      FROM shppee_risk_index
      WHERE EM_Shppws_Default_Rsk_Seg = 'Y'
        AND shppee_risk_index_id <> :NEW.shppee_risk_index_id
    ) THEN
      RAISE_APPLICATION_ERROR(-20000, '@shppws_msg_risk@');
    END IF;
  END IF;

  IF DELETING THEN
    RETURN OLD;
  ELSE
    RETURN NEW;
  END IF;
END SHPPWS_CHECK_DEFAULT_RSK_TRG
]]></body>
    </trigger>
  </database>
